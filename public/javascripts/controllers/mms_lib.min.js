try{document.execCommand("BackgroundImageCache",false,true)}catch(e){}$.extend($.pnotify.defaults,{pnotify_stack:{dir1:"down",dir2:"right",push:"down"}});jQuery.fn.extend({serialize:function(){var b=$.grep(this.serializeArray(),function(d,c){return d.value!="undefined"});var a=jQuery.param(b);return a}});MMS_CallBacks={rm_container:function(c,d,b,a){a.parents("[container]").fadeOut("slow",function(){$(this).remove()});if(a.attr("notify")){$.pnotify(a.attr("notify"))}},load_posts:function(c,d,b,a){$("#post_wapper_"+a.attr("data_id")).remove()},load_comments:function(c,d,b,a){if(/\d+/.test(c)){a.parents().parents().parents(".list_comments").html(c)}else{$.pnotify(c)}},load_favorites:function(c,d,b,a){if(/\d+/.test(c)){a.parents().parents().parents(".list_favorites").html(c)}else{$.pnotify(c)}},load_favorite_post:function(c,d,b,a){if(c){a.parents("span").html(c);$.pnotify(c)}},load_forward_tuan:function(c,d,b,a){if(c){if($("#dialog-form").length==0){$("body").append('<div id="dialog-form" title="??????">'+c+"</div>")}else{$("#dialog-form").html('<div id="dialog-form" title="??????">'+c+"</div>")}$("#dialog-form").dialog({resizable:false,height:450,width:460,modal:true,buttons:{"??????":function(){f=$("#dialog-form").find("form");$.post(f.attr("action"),function(g){alert(g)})},"??????":function(){$(this).dialog("close")}}});$("???forward_post_content").focus()}}};function callback(d,b,g,c){c.data("had_called",false);ajax_success_notify(c);var a=c.attr("callback")||"";if(a.length>0&&MMS_CallBacks[a]!=null){MMS_CallBacks[a].call(this,d,b,g,c)}}function ajax_start_notify(a){if(a.attr("s_notify")){$.pnotify(a.attr("s_notify"))}}function ajax_success_notify(a){if(a.attr("e_notify")){$.pnotify(a.attr("e_notify"))}}function auto_ajax_submit(){var a=$(this);var b=a.serialize();b._method=a.attr("auto_remote");$.post(a.attr("action"),b,function(d,c,g){callback.call(this,d,c,g,a)});return false}function had_called(a){if(a.data("had_called")){$.pnotify("???????????????????????????????????????");return true}a.data("had_called",false);return false}function auto_ajax_link(){var b=$(this);if(!had_called(b)){b.data("had_called",true);ajax_start_notify(b);if(b.attr("auto_remote")=="delete"){$.post(b.attr("ahref"),{_method:"delete"},function(d,a,h){callback.call(this,d,a,h,b)})}if(b.attr("auto_remote")=="get"){$.get(b.attr("ahref"),function(d,a,h){callback.call(this,d,a,h,b)})}if(b.attr("auto_remote")=="post"){var g={};var c=/^data_.*/;$.each(b[0].attributes,function(d,a){if(c.test(a.name)){var h=a.name.replace("data_","")}g[h]=a.value});$.post(b.attr("ahref"),g,function(d,a,h){callback.call(this,d,a,h,b)})}}return false}function dialog(){var b=$(this);if(b.attr("dialog")=="dialog-confirm"){dialog_for_link(b)}if(b.attr("dialog")=="dialog-form"){dialog_for_form(b)}}function dialog_for_link(b){var g={};var c=/^data_.*/;$.each(b[0].attributes,function(d,a){if(c.test(a.name)){var h=a.name.replace("data_","")}g[h]=a.value});if($("#dialog-confirm").length==0){$("body").append('<div id="dialog-confirm" title="??????????????????????"><p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>?????????????????????? </p></div>')}else{$("#dialog-confirm").html('<div id="dialog-confirm" title="??????????????????????"><p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>?????????????????????? </p></div>')}$("#dialog-confirm").dialog({resizable:false,height:140,modal:true,buttons:{"??????":function(){$.post(b.attr("ahref"),g,function(d,a,h){callback.call(this,d,a,h,b)});$(this).dialog("close")},"??????":function(){$(this).dialog("close")}}})}function dialog_for_form(b){var g={};var c=/^data_.*/;$.each(b[0].attributes,function(d,a){if(c.test(a.name)){var h=a.name.replace("data_","")}g[h]=a.value});$.post(b.attr("ahref"),g,function(d,a,h){callback.call(this,d,a,h,b)})}function delete_comment(d,c){var b=$(this);$.post(d,{},function(a){if(/\d+/.test(a)){$("#"+c).html(a)}else{$.pnotify(a)}$("#dialog-confirm").dialog("destroy");$("#dialog-confirm").remove()})}$(function(){$(document).ajaxError(function(e,xhr,opt){if(xhr.stauts==0){$.pnotify("?????????????????????????????????")}});$.tools.validator.fn("[maxlength]",function(input,value){var max=input.attr("maxlength");return(input.attr("placeholder")!=input.val()&&value.length<=max)?true:{cn:"?????????????????? "+max+" ?????????"}});$.tools.validator.fn("[minlength]",function(input,value){var min=input.attr("minlength");return(input.attr("placeholder")!=input.val()&&value.length>=min)?true:{cn:"??????????????? "+min+" ?????????"}});$.tools.validator.localize("cn",{"[required]":"?????????"});$("form[auto_remote]").live("submit",auto_ajax_submit);$("form").each(function(index,form){var f=$(form);var conf={lang:"cn"};if(f.attr("vd_pos")){conf.position=f.attr("vd_pos")}if(f.attr("vd_offset")){conf.offset=eval(f.attr("vd_offset"))}f.validator(conf)});$("a[auto_remote]").live("click",auto_ajax_link);$("[tooltip]").tooltip({effect:"slide"});$("[placeholder]").placeholder();$("a[dialog]").live("click",dialog);$("#dialog-cancel").live("click",function(){$("#dialog-confirm").dialog("close")})});