<% form_tag({:action => 'set_user', :id=>params[:id]}, {:onsubmit => "return myform_onsubmit()"}) do %>	   
    <script>
     var data={"-1_0":"text:设定权限;hint:设定权限",
         <% @users.each do |u| %>
               "<%=0%>_<%=u.id%>":"text:<%=u.name%>;",
        <% end%>
        "-100":"100"}
    </script>
        
    <%= render :partial => "share/tree", :locals => {:array=>@user_ids, :usecheckbox => true, :expandlevel => 3} %>
   
    <br/>
    &nbsp;&nbsp;<%= submit_tag " 保存 "%> | <%= link_to "返回", "/mms/menu/index"%>
<% end %>

<script>
function myform_onsubmit()
{
    var ids = GetCheckBox(trade);
    if (ids.length ==0) {
         alert("请至少选择一项");
         return false;
    } else {
         ids = ids.replace(", 0, ", "0, ");
    }
    $("#checked_values").val(ids);
}
</script>