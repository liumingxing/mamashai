<%= form_tag({:action=>"new_from_api", :id=>params[:id]}, :method=>"get") do %>
添加到: <b><%= @category.name %></b>（年龄段：<%= @category.age.split(',').collect{|id| Age.find(id).name}.join(' ') if @category.age%>）
ID: <%= text_field_tag :num_iid, params[:num_iid] %> 关键词: <%= text_field_tag :key, params[:key] %>
佣金比例(1000表示10.00%): <%= text_field_tag :start_commisionRate, params[:start_commisionRate] || 300, :style=>"width:40px" %>
至 <%= text_field_tag :end_commisionRate, params[:end_commisionRate] || 6000, :style=>"width:40px" %>
信誉大于: <%= select_tag :start_credit, options_for_select([['一心', '1heart'], ['两心', '2heart'], ['三心', '3heart'], ['四心', '4heart'], ['五心', '5heart'], ["一钻", "1diamond"], ["两钻", "2diamond"],["三钻", "3diamond"], ["四钻", "4diamond"],["五钻", "5diamond"]], params[:start_credit] || "3diamond") %>
排序: <%= select_tag :sort, options_for_select([['', ''], ["价格从高到低", 'price_desc'],["价格从低到高", 'price_asc'], ['信用等级从高到低', 'credit_desc'], ['佣金比率从高到低', 'commissionRate_desc'], ['佣金比率从低到高', 'commissionRate_asc'],['成交量成高到低', 'commissionNum_desc'],['总支出佣金从高到低', 'commissionVolume_desc']], params[:sort]||'') %>
<%= check_box_tag "mall_item", "true", params[:mall_item]=="true" %>商城<%= submit_tag "查询" %>
<% end %>
<div id="updater"></div>
<%= form_tag({:action=>"create_from_api", :id=>params[:id], :mall_item=>params[:mall_item]}, {:id=>"remote_form",:remote=>true})  do %>
<div style="text-align: right; margin: 10px;">
    <%= submit_tag "添加选中商品"%>
</div>
<table class="list" border="1" width="100%">
    <tr>
        <th>
        	<%= check_box_tag "select_all", '', false, :onchange=>"if ($(this).is(':checked')){$('td input').attr('checked',true)} else {$('td input').attr('checked', false)}" %>
        </th>
        <th>
            logo
        </th>
        <th>
            名称
        </th>
        <th>
            价格
        </th>
        <th>
            30成交量
        </th>
    </tr>
    <% for product in @products %>
    <tr>
        <td>
        	<% if !TaoProduct.find_by_iid(product["num_iid"]) %>
            <%= check_box_tag "num_iid[]", product["num_iid"] %>
            <% end %>
        </td>
        <td>
            <a target="_blank" href="<%= product["item_url"]%>"><img src="<%= product["pic_url"]%>_310x310.jpg" height=120  width=120/></a>
        </td>
        <td>
            <%=raw product["title"] %>
        </td>
        <td align='right'>
            <%= product["price"] %>
        </td>
        <td align='right'>
            <%= product["volume"] %>
        </td>
    </tr>
    <% end %>
    <tr>
        <th>
            <%= check_box_tag "select_all", '', false, :onchange=>"if ($(this).is(':checked')){$('td input').attr('checked',true)} else {$('td input').attr('checked', false)}" %>
        </th>
        <th colspan=4>
        </th>
    </tr>
</table>
<div style="text-align: right; margin: 10px;">
	<%= submit_tag "添加选中商品"%>
</div>
<% end %>
<div style="text-align: center;">
    <% 1.upto(10) do |i| %>
    <% if i==params[:page].to_i %>
    <span><%= i %></span>
    <% else %>
    <%= link_to i, :page=>i, :key=>params[:key], :start_commisionRate=>params[:start_commisionRate], :end_commisionRate=>params[:end_commisionRate], :sort=>params[:sort], :mall_item=>params[:mall_item], :start_credit=>params[:start_credit] %>
    <% end %>
    <% end %>
</div>

<script>
$("#remote_form").bind("ajax:complete", function(xhr, status){
    if (status.responseText == "ok"){
        alert("添加商品成功")
    }
    else{
        alert("添加商品出错")   
    }
})
</script>
