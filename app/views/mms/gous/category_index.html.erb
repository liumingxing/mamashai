<div id="middle">
    <div id="css_mainbody">
        <h1 class="title">导购平台-商品分类<span style="float: right; margin-right: 10px;"><%= link_to '添加分类', '/mms/gous/category_new' %>
            </span></h1>
        <% form_tag "/mms/gous/category_search", {:method => "get"} do %>
        <div>
            搜索：<%= text_field_tag "keyword",@keyword %><%= submit_tag "查询" %>
        </div>
        <% end %>
        <div style="margin: 20px 50px; border-bottom: 1px solid rgb(225, 225, 225); padding-bottom: 15px;font-size:13px;">
            <% GouCategory.publish.roots.each_with_index do |root,i| %>
            <a href="/mms/gous/category_index/<%=root.id%>"><%=root.name %></a>
            <% end %>
        </div>
        <div style="text-align:center;" class="green">
            <%= flash[:notice] %>
        </div>
        <div id="page_count">
        </div>
        <div style="margin:10px 15px;font-size:15px;">
            <b><%=@root.name %></b>
            <%= link_to '修改', "/mms/gous/category_edit/#{h @root.id}", {:style => "color:#329BCB;", :target => "_blank"} %>
            <%= link_to '删除', "/mms/gous/category_destroy/#{h @root.id}", {:confirm => '确认删除吗？', :method => :delete, :style => "color:#329BCB;"} %>
            <% if @root.state == "publish" %>
            <%= link_to '取消发布', {:action => 'category_unpublish', :id => @root.id}, {:style => "color:#329BCB;"} %>
            <% else %>
            <%= link_to '发布', {:action => 'category_publish', :id => @root.id}, {:style => "color:#329BCB;"} %>
            <% end %>
        </div>
        <div class="clear">
        </div>
        <% @root.children.each_with_index do |child,index| %>
        <div style="margin:5px 15px;">
            <b><%= child.name %></b>
            <%= link_to '修改', "/mms/gous/category_edit/#{h child.id}", {:style => "color:#329BCB;", :target => "_blank"} %>
            <%= link_to '删除', "/mms/gous/category_destroy/#{h child.id}", {:confirm => '确认删除吗？', :method => :delete, :style => "color:#329BCB;"} %>
            <% if child.state == "publish" %>
            <%= link_to '取消发布', {:action => 'category_unpublish', :id => child.id}, {:style => "color:#329BCB;"} %>
            <% else %>
            <%= link_to '发布', {:action => 'category_publish', :id => child.id}, {:style => "color:#329BCB;"} %>
            <% end %>
        </div>
        <table class="grid">
            <tr>
                <th width="5%">
                    序号
                </th>
                <th width="10%">
                    名称
                </th>
                <th width="10%">
                    上级分类
                </th>
                <th width="5%">
                    商品数目
                </th>
                <th width="10%">
                匹配分类
                <th width="5%">
                    是否发布
                </th>
                <th width="10%">
                    操作
                </th>
            </tr>
            <% child.children.each_with_index do |category,index| %>
            <tr>
                <td>
                    <%=(index+1).to_s %>
                </td>
                <td>
                    <%=category.name %>
                </td>
                <td>
                    <%=category.parent.blank? ? '无' : category.parent.name %>
                </td>
                <td>
                    <%=category.gous_count||0 %>
                </td>
                <td>
                    <%= category.brand_item %>
                </td>
                <td>
                    <% if category.state == "publish" %>
                    <img src="/images/icons/icons_01.png" alt="/images/icons/icons_01.png"><% else %>
                    <img src="/images/icons/icon_25.gif" alt="/images/icons/icon_25.gif"><% end %>
                </td>
                <td>
                    <%= link_to '修改', "/mms/gous/category_edit/#{h category.id}", {:style => "color:#329BCB;", :target => "_blank"} %>
                    <%= link_to '删除', "/mms/gous/category_destroy/#{h category.id}", {:confirm => '确认删除吗？', :method => :delete, :style => "color:#329BCB;"} %>
                    <% if category.state == "publish" %>
                    <%= link_to '取消发布', {:action => 'category_unpublish', :id => category.id}, {:style => "color:#329BCB;"} %>
                    <% else %>
                    <%= link_to '发布', {:action => 'category_publish', :id => category.id}, {:style => "color:#329BCB;"} %>
                    <% end %>
                </td>
            </tr>
            <% end %>
        </table>
        <%end %>
    </div>
    <div class="clear">
    </div>
</div>
