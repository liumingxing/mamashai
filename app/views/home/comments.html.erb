<DIV id="chanel_content">
	<%= render :partial=>"nav_notice" %>

        <% if @comments.blank? %>
        <div class="ifnull">
            目前还没有任何评论
        </div>
        <% else %>
        <div style="line-height: 25px; margin-top: 10px; background:#f0f2f3; padding-left: 10px;">
            <span class="title"><input name="checkbox" id="all_checkbox" value="checkbox" class="form_checkbox" onclick="select_all_comments(this);" type="checkbox">&nbsp;&nbsp;<a href="javascript:void(0);" onclick="select_all_comments_form_link('all_checkbox');">全选</a> |&nbsp;<a href="javascript:delete_comments('<%=params[:action]%>');">删除所选</a></span>
        </div>
        <% for comment in @comments %>
        <div id="comment_wapper_<%=comment.id%>" class="comments_all">
            <div class="all">
            	<input name="comment_ids" type="checkbox" class="form_checkbox" value="<%=comment.id%>" /> 
            </div>
            <div class="comments_pic">
                <%=logo_tag(comment.user,{:version=>'thumb48',:url=>user_url(comment.user)}) %>
            </div>
            <div class="comments_article">
                <div class="article01">
                    <span class="from"><a href="<%=user_url(comment.user)%>"><%=comment.user.name %></a>：<%=post_content comment.content.to_s %></span>
                    <div class="clear">
                    </div>
                </div>
                <div class="article01">
                    <% comment_post_user = comment.post.user %>
                    <% next if !comment_post_user %>
                    <span class="from">评论<a href="<%=user_url(comment_post_user)%>"><%=comment_post_user.name %></a>的微博：<a href="/post/<%=comment.post.id%>" target="_blank" title="<%=truncate comment.post.content, :length=>100 %>"><%=truncate comment.post.content, :length=>100 %></a></span>
                    <span class="dat dat01"></span>
                </div>
                <div class="clear">
                </div>
            </div>
            <div class="clear">
            </div>
			<div class="user_tools">
                <span class="tools"><a href="javascript:void(0);" onclick="show_confirm_box('您确定删除吗该评论吗？', '/ajax/delete_post_comment/<%= comment.id %>', function(){$('#comment_wapper_<%= comment.id%>').fadeOut();}, this)">删除</a>
				<% if comment.user_id != @user.id %>
				<a href="javascript:void(0);" onclick="$('#comment_reply_area_<%=comment.id%>').toggle('slow'); $('#comment_content_<%=comment.id%>').setCurPos(100);">回复</a>
				 <% end %>
				 </span>
                <div class="clear">
                </div>
            </div>
			<% if comment.user_id != @user.id %>
			<div id="comment_reply_result_<%=comment.id%>">
			</div>
            <div id="comment_reply_area_<%=comment.id%>">
                <div class="comments01">
                    <div class="comments01_bg1">
                    </div>
                    <div id="comment_reply_form_<%=comment.id%>" class="comments01_bg2">
                       <%= form_tag({:controller=>"ajax", :action=>"create_reply_comment", :id=>comment.post.id, :comment_id=>comment.id}, {:remote=>true, :id=>"comment_#{comment.id}"}) do %>
                            <div class="login_input">
                                <span class="left">
                                    <%= text_area :comment, :content,{:id=>"comment_content_#{comment.id}",:onpropertychange=>"updateStatusTextContent(this)",:oninput=>"updateStatusTextContent(this)"} %>
                                </span>
                                <span class="right">
                                    <button class="button_submit_s" type="submit" onmouseover="this.className='button_submit_s button_submit_s_hover';" onmouseout="this.className='button_submit_s';">
                                        回复 
                                    </button>
                                </span>
                                <div class="clear">
                                </div>
                            </div>
                            <div class="one" style="margin-top: 5px;">
                                <input name="is_copy_post" type="checkbox"/>&nbsp;同时发一条微博 
                            </div>
							<script>$('#comment_content_<%=comment.id%>').get(0).value='回复@<%=comment.user.name %>:';$('#comment_reply_area_<%=comment.id%>').hide();</script>
                       <% end %>
                       <script>
                        $("#comment_<%= comment.id %>").bind("ajax:complete", function(xhr, status){
                            $("#comment_reply_result_<%=comment.id%>").empty()
                            $("#comment_reply_result_<%=comment.id%>").append(status.responseText)
                        })
                       </script>
                    </div>
                    <div class="comments01_bg3">
                    </div>
                </div>
                <div class="clear">
                </div>
            </div>
			 <% end %>
        </div>
        <% end %>
        <% end %>
    </div>
    <%=will_paginate @reminds %>
    <div class="clear">
    </div>

<script>
	jQuery.fn.extend({  
    getCurPos: function(){  
        var e=$(this).get(0);  
        e.focus();  
        if(e.selectionStart){    //FF  
            return e.selectionStart;  
        }  
        if(document.selection){    //IE  
            var r = document.selection.createRange();  
            if (r == null) {  
                return e.value.length;  
            }  
            var re = e.createTextRange();  
            var rc = re.duplicate();  
            re.moveToBookmark(r.getBookmark());  
            rc.setEndPoint('EndToStart', re);  
            return rc.text.length;  
        }  
        return e.value.length;  
    },  
    setCurPos: function(pos) {  
        var e=$(this).get(0);  
        e.focus();  
        if (e.setSelectionRange) {  
            e.setSelectionRange(pos, pos);  
        } else if (e.createTextRange) {  
            var range = e.createTextRange();  
            range.collapse(true);  
            range.moveEnd('character', pos);  
            range.moveStart('character', pos);  
            range.select();  
        }  
    }          
}); 
</script>